copy (select distinct lineref, startstoppointref, a.quaycoderef as startquaycoderef, a.stopplacecoderef as startstopplacecoderef, endstoppointref, b.quaycoderef as endquaycoderef, b.stopplacecoderef as endstopplacecoderef, price, distance, entranceratewrtcurrency, currency from (select max(deliveryref) as deliveryref, lineref, startstoppointref, endstoppointref, price, distance, entranceratewrtcurrency, currency from fare.origin_destinationmatrix join fare.delivery on (id = deliveryref) where enddate > now() and startdate < now() group by lineref, startstoppointref, endstoppointref, price, distance, entranceratewrtcurrency, currency) as matrix left join stoppoint as a on (startstoppointref = a.operator_id) left join stoppoint as b on (endstoppointref = b.operator_id) order by lineref, startstoppointref, distance)  to '/home/projects/ovtarieven/csv/origin_destinationmatrix.csv' csv header;
